document.addEventListener("contextmenu",(e=>e.preventDefault())),document.addEventListener("keydown",(e=>{("F12"===e.key||(e.ctrlKey||e.metaKey)&&e.shiftKey&&"I"===e.key||(e.ctrlKey||e.metaKey)&&e.shiftKey&&"J"===e.key||(e.ctrlKey||e.metaKey)&&"U"===e.key)&&e.preventDefault()}));const disableSelect=e=>{(e.target.classList.contains("no-select")||e.target.closest(".card-header")||e.target.closest(".sgpa-display")||e.target.closest(".logo"))&&e.preventDefault()};function renderUI(){document.getElementById("app").innerHTML='\n        <div class="bg-blob blob-1"></div>\n        <div class="bg-blob blob-2"></div>\n        \n        <div class="container">\n            <header>\n                <div class="logo">\n                    <div class="logo-icon">\n                        <i class="fas fa-calculator"></i>\n                    </div>\n                    <div class="logo-text">GradeFlow Pro</div>\n                </div>\n                <div class="theme-toggle" id="themeToggle">\n                    <i class="fas fa-sun"></i>\n                    <i class="fas fa-moon"></i>\n                </div>\n            </header>\n            \n            <div class="dashboard">\n                <div class="main-content">\n                    <div class="card">\n                        <div class="card-header">\n                            <h2 class="card-title"><i class="fas fa-keyboard"></i> Calculate Your Grades</h2>\n                        </div>\n                        \n                        <div class="tabs" id="mainTabs">\n                            <div class="tab active" data-tab="sgpa-calc">SGPA Calculator</div>\n                            <div class="tab" data-tab="cgpa-calc">CGPA Calculator</div>\n                        </div>\n                        \n                        \x3c!-- SGPA Calculator Tab Content --\x3e\n                        <div class="tab-content active" id="sgpa-calc">\n                            <div class="tabs sub-tabs" id="sgpaSubTabs">\n                                <div class="tab active" data-tab="manual-sgpa">Manual Entry</div>\n                                <div class="tab" data-tab="paste-sgpa">Paste Results</div>\n                            </div>\n\n                            \x3c!-- Manual Entry for SGPA --\x3e\n                            <div class="tab-content active" id="manual-sgpa">\n                                <div class="input-group">\n                                    <label for="subjectName">Subject Name</label>\n                                    <input type="text" id="subjectName" placeholder="e.g., Data Structures, Engineering Math">\n                                    <span class="error-message" id="subjectNameError"></span>\n                                </div>\n                                \n                                <div class="input-group">\n                                    <label for="credits">Credits</label>\n                                    <input type="number" id="credits" placeholder="e.g., 4" min="1" max="10" step="0.1">\n                                    <span class="error-message" id="creditsError"></span>\n                                </div>\n                                \n                                <div class="input-group">\n                                    <label for="grade">Grade</label>\n                                    <select id="grade">\n                                        <option value="">Select Grade</option>\n                                        <option value="10">A+ (10)</option>\n                                        <option value="9">A (9)</option>\n                                    <option value="8">B+ (8)</option>\n                                    <option value="7">B (7)</option>\n                                    <option value="6">C+ (6)</option>\n                                    <option value="5">C (5)</option>\n                                    <option value="4">D (4)</option>\n                                    <option value="0">F (0)</option>\n                                    <option value="QUALIFIED">Qualified</option>\n                                    <option value="ABSENT">Absent</option>\n                                    </select>\n                                    <span class="error-message" id="gradeError"></span>\n                                </div>\n                                \n                                <button class="add-btn" id="addSubject">\n                                    <i class="fas fa-plus"></i> Add Subject\n                                </button>\n                            </div>\n                            \n                            \x3c!-- Paste Results for SGPA --\x3e\n                            <div class="tab-content" id="paste-sgpa">\n                                <div class="input-group paste-input-group">\n                                    <div> \n                                        <label for="resultText">Paste Your Result Sheet</label>\n                                        <textarea id="resultText" rows="6" placeholder="Paste your result sheet text here..."></textarea>\n                                    </div>\n                                    <button class="paste-button" id="mobilePasteBtn">\n                                        <i class="fas fa-paste"></i> Paste\n                                    </button>\n                                </div>\n                                \n                                <button class="add-btn" id="parseResults">\n                                    <i class="fas fa-magic"></i> Parse Results\n                                </button>\n                                \n                                <div id="parseStatus" class="status-bar" style="display: none;">\n                                    <i class="fas fa-sync fa-spin"></i>\n                                    <span>Processing your results...</span>\n                                </div>\n                            </div>\n\n                            <div class="result-container">\n                                <div class="card-header">\n                                    <h3 class="card-title"><i class="fas fa-list-alt"></i> Current Semester Subjects</h3>\n                                    <button class="action-btn" id="resetBtn" title="Clear all subjects">\n                                        <i class="fas fa-trash-alt"></i> Clear All\n                                    </button>\n                                </div>\n                                \n                                <table id="resultTable">\n                                    <thead>\n                                        <tr>\n                                            <th>Subject</th>\n                                            <th>Credits</th>\n                                            <th>Grade</th>\n                                            <th>Points</th>\n                                            <th>Actions</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody id="resultBody">\n                                        \x3c!-- SGPA subjects will be populated here --\x3e\n                                    </tbody>\n                                </table>\n                            </div>\n                        </div>\n                        \n                        \x3c!-- CGPA Calculator Tab Content --\x3e\n                        <div class="tab-content" id="cgpa-calc">\n                            <div class="input-group cgpa-input-grid">\n                                <div>\n                                    <label for="semesterSgpa">Semester SGPA</label>\n                                    <input type="number" id="semesterSgpa" placeholder="e.g., 8.5" min="0" max="10" step="0.01">\n                                    <span class="error-message" id="semesterSgpaError"></span>\n                                </div>\n                                <div>\n                                    <label for="semesterCredits">Total Credits</label>\n                                    <input type="number" id="semesterCredits" placeholder="e.g., 20" min="1" step="0.1">\n                                    <span class="error-message" id="semesterCreditsError"></span>\n                                </div>\n                                <button class="add-btn" id="addSemester">\n                                    <i class="fas fa-plus-circle"></i> Add Semester\n                                </button>\n                            </div>\n\n                            <div class="result-container">\n                                <div class="card-header">\n                                    <h3 class="card-title"><i class="fas fa-history"></i> Previous Semesters</h3>\n                                    <button class="action-btn" id="resetCgpaBtn" title="Clear all semester data">\n                                        <i class="fas fa-trash-alt"></i> Clear All\n                                    </button>\n                                </div>\n                                <table id="cgpaTable">\n                                    <thead>\n                                        <tr>\n                                            <th>SGPA</th>\n                                            <th>Credits</th>\n                                            <th>Total Points</th>\n                                            <th>Actions</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody id="cgpaBody">\n                                        \x3c!-- CGPA semester entries will be populated here --\x3e\n                                    </tbody>\n                                </table>\n                                <div class="empty-state" id="cgpaEmptyState" style="display: block;">\n                                    <i class="fas fa-inbox"></i>\n                                    <p>No semesters added yet for CGPA calculation. Add your previous semester SGPAs!</p>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    \x3c!-- Features Grid (retained) --\x3e\n                    <div class="features-grid">\n                        <div class="feature-card">\n                            <div class="feature-icon">\n                                <i class="fas fa-brain"></i>\n                            </div>\n                            <div class="feature-text">\n                                <h3>Advanced Parsing</h3>\n                                <p>Intelligent result sheet extraction</p>\n                            </div>\n                        </div>\n                        \n                        <div class="feature-card">\n                            <div class="feature-icon">\n                                <i class="fas fa-rocket"></i>\n                            </div>\n                            <div class="feature-text">\n                                <h3>Blazing Fast</h3>\n                                <p>Optimized for quick calculations</p>\n                            </div>\n                        </div>\n                        \n                        <div class="feature-card">\n                            <div class="feature-icon">\n                                <i class="fas fa-file-export"></i>\n                            </div>\n                            <div class="feature-text">\n                                <h3>Professional Reports</h3>\n                                <p>Beautiful PDF and CSV exports</p>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                \n                <div class="sidebar">\n                    \x3c!-- SGPA/CGPA Display Card --\x3e\n                    <div class="card sgpa-display">\n                        <div class="sgpa-label" id="currentGradeLabel">Your Semester Grade Point Average</div>\n                        <div class="sgpa-value" id="currentGradeValue">0.00</div>\n                        <div class="sgpa-scale">Scale: 0.00 - 10.00</div>\n                        \n                        \x3c!-- Chart for SGPA --\x3e\n                        <div class="chart-container" id="sgpaChartContainer">\n                            <canvas id="gradeChart"></canvas>\n                        </div>\n\n                        \x3c!-- Progress Bar for CGPA --\x3e\n                        <div class="cgpa-progress-container" id="cgpaProgressBarContainer">\n                            <div class="cgpa-progress-bar" id="cgpaProgressBar"></div>\n                            <div class="cgpa-progress-label" id="cgpaProgressLabel">0.00 / 10.00</div>\n                        </div>\n                    </div>\n                    \n                    \x3c!-- Export Results Card (retained) --\x3e\n                    <div class="card" style="margin-bottom: 20px;">\n                        <div class="card-header">\n                            <h2 class="card-title"><i class="fas fa-download"></i> Export Results</h2>\n                        </div>\n                        \n                        <div class="export-actions">\n                            <button class="export-btn pdf" id="exportPdf">\n                                <i class="fas fa-file-pdf"></i> Export PDF\n                            </button>\n                            <button class="export-btn csv" id="exportCsv">\n                                <i class="fas fa-file-csv"></i> Export CSV\n                            </button>\n                        </div>\n                    </div>\n\n                    \x3c!-- Report Bug/Feedback Form (retained) --\x3e\n                    <div class="card">\n                        <div class="card-header">\n                            <h2 class="card-title"><i class="fas fa-bug"></i> Report Bug / Feedback</h2>\n                        </div>\n                        <div class="input-group">\n                            <label for="feedbackText">Describe the issue or provide feedback:</label>\n                            <textarea id="feedbackText" rows="4" placeholder="e.g., Calculation error, layout issue, new feature request..."></textarea>\n                        </div>\n                        <button class="add-btn" id="sendFeedbackBtn">\n                            <i class="fas fa-paper-plane"></i> Send Feedback\n                        </button>\n                    </div>\n                </div>\n            </div>\n            \n            <footer>\n                <p>Crafted with Precision by Ankit Tiwari</p>\n                <a href="https://www.linkedin.com/in/ankit-k-tiwari/" target="_blank" class="linkedin-btn">\n                    <i class="fab fa-linkedin"></i> Connect on LinkedIn\n                </a>\n                <p>GradeFlow Pro &copy; 2025 | All calculations done locally on your device | Advanced Parsing Engine v3.0</p>\n            </footer>\n        </div>\n\n        \x3c!-- Custom Confirmation Modal --\x3e\n        <div class="custom-modal-overlay" id="customConfirmModal">\n            <div class="custom-modal-content">\n                <h3>Confirm Action</h3>\n                <p id="confirmMessage">Are you sure you want to perform this action?</p>\n                <div class="custom-modal-buttons">\n                    <button class="btn-confirm" id="confirmYes">Yes</button>\n                    <button class="btn-cancel" id="confirmNo">Cancel</button>\n                </div>\n            </div>\n        </div>\n    '}function initApp(){const e=document.getElementById("themeToggle"),t=document.querySelectorAll("#mainTabs .tab"),a=document.querySelectorAll("#sgpaSubTabs .tab"),n=document.getElementById("sgpa-calc"),s=document.getElementById("cgpa-calc"),d=document.getElementById("manual-sgpa"),i=document.getElementById("paste-sgpa"),l=document.getElementById("addSubject"),o=document.getElementById("parseResults"),r=document.getElementById("resetBtn"),c=document.getElementById("exportPdf"),u=document.getElementById("exportCsv"),p=document.getElementById("resultBody"),m=document.getElementById("currentGradeValue"),g=document.getElementById("currentGradeLabel"),v=document.getElementById("subjectName"),b=document.getElementById("credits"),f=document.getElementById("grade"),y=document.getElementById("resultText"),h=document.getElementById("parseStatus"),C=document.getElementById("feedbackText"),x=document.getElementById("sendFeedbackBtn"),E=document.getElementById("mobilePasteBtn"),A=document.getElementById("subjectNameError"),S=document.getElementById("creditsError"),B=document.getElementById("gradeError"),P=document.getElementById("semesterSgpaError"),L=document.getElementById("semesterCreditsError"),F=document.getElementById("addSemester"),I=document.getElementById("resetCgpaBtn"),k=document.getElementById("semesterSgpa"),T=document.getElementById("semesterCredits"),G=document.getElementById("cgpaBody"),N=document.getElementById("cgpaEmptyState"),w=document.getElementById("sgpaChartContainer"),$=document.getElementById("cgpaProgressBarContainer"),D=document.getElementById("cgpaProgressBar"),j=document.getElementById("cgpaProgressLabel"),R=document.getElementById("customConfirmModal"),U=document.getElementById("confirmMessage"),M=document.getElementById("confirmYes"),q=document.getElementById("confirmNo"),Q={10:"A+",9:"A",8:"B+",7:"B",6:"C+",5:"C",4:"D",0:"F",QUALIFIED:"Qualified",ABSENT:"Absent"},H={"A+":10,A:9,"B+":8,B:7,"C+":6,C:5,D:4,F:0,E:0,I:0,QUALIFIED:"QUALIFIED",ABSENT:"ABSENT"};let Y=[],z=[];Chart.defaults.font.family="Poppins";const V=document.getElementById("gradeChart").getContext("2d"),K=new Chart(V,{type:"doughnut",data:{labels:["A+","A","B+","B","C+","C","D","F"],datasets:[{data:[0,0,0,0,0,0,0,0],backgroundColor:[],borderWidth:0,hoverOffset:15}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{color:"",font:{size:11},padding:15}},tooltip:{callbacks:{label:function(e){return`${e.label}: ${e.parsed} subjects`}}}},cutout:"65%"}});function O(){const e=document.body.classList.contains("dark-mode");K.options.plugins.legend.labels.color=e?getComputedStyle(document.body).getPropertyValue("--text-dark"):getComputedStyle(document.body).getPropertyValue("--text-light"),K.data.datasets[0].backgroundColor=e?["#4cc9f0","#4361ee","#3a0ca3","#7209b7","#f72585","#ff6b6b","#ff9e00","#adb5bd"]:["#1ABC9C","#2ECC71","#3498DB","#9B59B6","#F1C40F","#E67E22","#E74C3C","#BDC3C7"],K.update()}e.addEventListener("click",(()=>{document.body.classList.toggle("dark-mode"),localStorage.setItem("gradeFlowTheme",document.body.classList.contains("dark-mode")?"dark":"light"),O(),le()}));let _=null;function Z(e,t){U.textContent=e,_=t,R.classList.add("active")}function W(e,t,a,n){return a(e.value)?(e.classList.remove("invalid"),t.textContent="",!0):(e.classList.add("invalid"),t.textContent=n,!1)}function J(e,t,a,n){let s={code:"",name:"",credits:0,grade:void 0},d=[],i=[],l="",o=!1;const r=t.exec(e[0]);if(!r)return null;s.code=r[1];for(let s=1;s<e.length;s++){const r=e[s].trim();if(""===r)continue;const c=n.exec(r);if(c){l=c[1].toUpperCase(),"QUALIFIED"!==l&&"ABSENT"!==l||(o=!0);break}const u=a.exec(r);u?i.push(parseFloat(u[0])):t.test(r)||r.includes("Disclaimer")||r.includes("University")||r.includes("Helpline")||r.includes("Report a Bug")||d.push(r)}return s.name=d.join(" ").trim(),s.grade=o?l:H[l],i.length>0?s.credits=i[i.length-1]:s.credits=0,s.code&&!isNaN(s.credits)&&s.credits>0&&void 0!==s.grade&&s.name?s:null}function X(e){let t=e.trim();var a;t.includes("<")&&t.includes(">")&&(a=t,t=(new DOMParser).parseFromString(a,"text/html").body.textContent||"");const n=t.split("\n").map((e=>e.trim())).filter((e=>e.length>0));let s=[];const d=/^(\d{2}[A-Z]{3}-\d{3,4})$/i,i=/^\d+(\.\d+)?$/,l=/^([A-Z]+[+]?|Qualified|Absent|E|F|I)$/i,o=/^(\d{2}[A-Z]{3}-\d{3,4})\s+(.+?)\s+(?:(?:\d+(?:\.\d+)?|\s*)\s+){0,2}(\d+(?:\.\d+)?)\s+([A-Z]+[+]?|Qualified|Absent|E|F|I)$/i,r=["Disclaimer:","University is not responsible","General Helpline No:","Email Id:","Report a Bug","Chandigarh University, Gharuan, Mohali (Punjab)"];let c=[],u=!1;for(let e=0;e<n.length;e++){const t=n[e].trim();if(""===t)continue;const a=t.toLowerCase();if(r.some((e=>a.includes(e.toLowerCase())))){if(u&&c.length>0){const e=J(c,d,i,l);e&&s.push(e)}u=!1,c=[];continue}const p=o.exec(t);if(p){const e=p[4].toUpperCase();s.push({code:p[1],name:p[2].trim(),credits:parseFloat(p[3]),grade:"QUALIFIED"===e||"ABSENT"===e?e:H[e]}),u=!1,c=[]}else if(d.test(t)){if(u&&c.length>0){const e=J(c,d,i,l);e&&s.push(e)}c=[t],u=!0}else u&&c.push(t)}if(u&&c.length>0){const e=J(c,d,i,l);e&&s.push(e)}return s}function ee(){p.innerHTML="",0!==Y.length?Y.forEach(((e,t)=>{const a=document.createElement("tr"),n="QUALIFIED"===e.grade||"ABSENT"===e.grade;let s;a.classList.toggle("bg-gray-100",n),a.classList.toggle("text-gray-500",n),a.classList.toggle("italic",n),s=n?e.grade:Q[e.grade]||"N/A";const d=n?"N/A":void 0!==e.grade?e.grade.toFixed(2):"N/A";a.innerHTML=`\n                <td>\n                    <div><strong>${e.code}</strong></div>\n                    <div style="font-size: 0.9em; opacity: 0.8;">${e.name}</div>\n                </td>\n                <td>${e.credits.toFixed(1)}</td>\n                <td>${s}</td>\n                <td>${d}</td>\n                <td class="actions">\n                    <button class="action-btn" title="Delete" onclick="deleteSubject(${t})">\n                        <i class="fas fa-trash-alt"></i>\n                    </button>\n                </td>\n            `,p.appendChild(a)})):p.innerHTML='\n                <tr class="empty-state">\n                    <td colspan="5">\n                        <i class="fas fa-inbox"></i>\n                        <p>No subjects added yet. Start by adding subjects manually or pasting your results!</p>\n                    </td>\n                </tr>\n            '}function te(){if(0===Y.length)return 0;let e=0,t=0;return Y.forEach((a=>{"number"==typeof a.grade&&!isNaN(a.grade)&&a.credits>0&&(e+=a.credits,t+=a.credits*a.grade)})),0===e?0:t/e}function ae(){const e=te();m.textContent=e.toFixed(2),m.classList.add("highlight"),setTimeout((()=>m.classList.remove("highlight")),2e3),le()}function ne(){const e={"A+":0,A:0,"B+":0,B:0,"C+":0,C:0,D:0,F:0};Y.forEach((t=>{if("number"==typeof t.grade&&!isNaN(t.grade)&&t.credits>0){const a=Q[t.grade];e.hasOwnProperty(a)&&e[a]++}})),K.data.datasets[0].data=[e["A+"],e.A,e["B+"],e.B,e["C+"],e.C,e.D,e.F],O(),K.update()}function se(){G.innerHTML="",0!==z.length?(N.style.display="none",z.forEach(((e,t)=>{const a=document.createElement("tr"),n=e.sgpa*e.credits;a.innerHTML=`\n                <td>${e.sgpa.toFixed(2)}</td>\n                <td>${e.credits.toFixed(1)}</td>\n                <td>${n.toFixed(2)}</td>\n                <td class="actions">\n                    <button class="action-btn" title="Delete" onclick="deleteSemester(${t})">\n                        <i class="fas fa-trash-alt"></i>\n                    </button>\n                </td>\n            `,G.appendChild(a)}))):N.style.display="block"}function de(){if(0===z.length)return 0;let e=0,t=0;return z.forEach((a=>{e+=a.sgpa*a.credits,t+=a.credits})),0===t?0:e/t}function ie(){const e=de();m.textContent=e.toFixed(2),m.classList.add("highlight"),setTimeout((()=>m.classList.remove("highlight")),2e3),le(),function(e){const t=e/10*100;D.style.width=`${t}%`,j.textContent=`${e.toFixed(2)} / 10.00`}(e)}function le(){const e=parseFloat(m.textContent),t=document.body.classList.contains("dark-mode");m.style.color=t?e>=9?"#4cc9f0":e>=8?"#4361ee":e>=7?"#7209b7":e>=6?"#f72585":"#ff6b6b":getComputedStyle(document.body).getPropertyValue("--text-dark")}function oe(e,t){h.style.display="flex",h.classList.toggle("error",t),h.innerHTML=`<i class="fas ${t?"fa-exclamation-circle":"fa-check-circle"}"></i> <span>${e}</span>`,t||setTimeout((()=>{h.style.display="none"}),3e3)}M.addEventListener("click",(()=>{_&&_(!0),R.classList.remove("active"),_=null})),q.addEventListener("click",(()=>{_&&_(!1),R.classList.remove("active"),_=null})),t.forEach((e=>{e.addEventListener("click",(()=>{const a=e.getAttribute("data-tab");t.forEach((e=>e.classList.remove("active"))),e.classList.add("active"),n.classList.remove("active"),s.classList.remove("active"),"sgpa-calc"===a?(n.classList.add("active"),w.style.display="block",$.style.display="none",Y=[],ee(),ae(),ne(),g.textContent="Your Semester Grade Point Average"):"cgpa-calc"===a&&(s.classList.add("active"),w.style.display="none",$.style.display="block",z=[],se(),ie(),K.data.datasets[0].data=K.data.labels.map((()=>0)),K.update(),g.textContent="Your Cumulative Grade Point Average"),h.style.display="none",v.value="",b.value="",f.value="",y.value="",k.value="",T.value="",document.querySelectorAll(".invalid").forEach((e=>e.classList.remove("invalid"))),document.querySelectorAll(".error-message").forEach((e=>e.textContent=""))}))})),a.forEach((e=>{e.addEventListener("click",(()=>{const t=e.getAttribute("data-tab");a.forEach((e=>e.classList.remove("active"))),e.classList.add("active"),d.classList.remove("active"),i.classList.remove("active"),"manual-sgpa"===t?d.classList.add("active"):"paste-sgpa"===t&&i.classList.add("active"),v.value="",b.value="",f.value="",y.value="",h.style.display="none",document.querySelectorAll(".invalid").forEach((e=>e.classList.remove("invalid"))),document.querySelectorAll(".error-message").forEach((e=>e.textContent=""))}))})),E.addEventListener("click",(async()=>{try{const e=await navigator.clipboard.readText();y.value=e,oe("Content pasted successfully!",!1)}catch(e){oe("Failed to paste. Please paste manually.",!0)}})),l.addEventListener("click",(()=>{let e=!0;W(v,A,(e=>""!==e.trim()),"Subject name cannot be empty.")||(e=!1);const t=parseFloat(b.value);if(W(b,S,(e=>!isNaN(parseFloat(e))&&parseFloat(e)>0&&parseFloat(e)<=10),"Credits must be a number between 1 and 10.")||(e=!1),W(f,B,(e=>""!==e),"Please select a grade.")||(e=!1),!e)return void oe("Please correct the errors in the form.",!0);const a=v.value.trim(),n=t,s=f.value;let d;d="QUALIFIED"===s||"ABSENT"===s?s:parseInt(s),Y.push({name:a,credits:n,grade:d,code:a.substring(0,Math.min(a.length,10)).toUpperCase()}),ee(),ae(),ne(),v.value="",b.value="",f.value="",oe("Subject added successfully!",!1)})),o.addEventListener("click",(()=>{const e=y.value.trim();if(!e)return oe("Please paste your result sheet",!0),void(h.style.display="none");h.style.display="flex",h.classList.remove("error"),h.innerHTML='<i class="fas fa-sync fa-spin"></i> Processing your results...',setTimeout((()=>{try{const t=X(e);if(0===t.length)return oe("No valid subjects found. Check your format.",!0),void(h.style.display="none");Y=t,ee(),ae(),ne(),oe(`Successfully parsed ${t.length} subjects!`,!1),y.value=""}catch(e){oe(`Error: ${e.message}`,!0),h.style.display="none"}}),100)})),r.addEventListener("click",(()=>{Z("Are you sure you want to clear all current semester subjects?",(e=>{e&&(Y=[],ee(),ae(),ne(),h.style.display="none",oe("Current semester subjects cleared!",!1))}))})),c.addEventListener("click",(async()=>{const e=document.querySelector("#mainTabs .tab.active").getAttribute("data-tab");if("sgpa-calc"!==e||0!==Y.length)if("cgpa-calc"!==e||0!==z.length)try{const{jsPDF:t}=window.jspdf,a=new t;a.setFontSize(22),a.setTextColor(67,97,238);let n="",s="",d=0,i=[],l=[];"sgpa-calc"===e?(n="SGPA Report",s="Current SGPA:",d=te(),i=[["Subject Code","Subject Name","Credits","Grade","Points"]],l=Y.filter((e=>"number"==typeof e.grade&&!isNaN(e.grade)&&e.credits>0)).map((e=>[e.code,e.name,e.credits.toFixed(1),Q[e.grade],e.grade.toFixed(2)]))):"cgpa-calc"===e&&(n="CGPA Report",s="Calculated CGPA:",d=de(),i=[["Semester SGPA","Total Credits","Weighted Points"]],l=z.map((e=>[e.sgpa.toFixed(2),e.credits.toFixed(1),(e.sgpa*e.credits).toFixed(2)]))),a.text(n,105,20,null,null,"center"),a.setFontSize(12),a.setTextColor(100,100,100),a.text("Generated by GradeFlow Pro: Your Academic Compass",105,28,null,null,"center");const o=new Date;a.setFontSize(14),a.setTextColor(document.body.classList.contains("dark-mode")?255:0),a.text(`Date: ${o.toLocaleDateString()}`,15,40),a.text(`${s} ${d.toFixed(2)}`,15,50),a.autoTable({startY:60,head:i,body:l,theme:"grid",headStyles:{fillColor:[67,97,238],textColor:255,fontStyle:"bold"},styles:{cellPadding:3,fontSize:10,valign:"middle",textColor:document.body.classList.contains("dark-mode")?255:0},margin:{top:10}});const r=a.internal.getNumberOfPages();for(let e=1;e<=r;e++)a.setPage(e),a.setFontSize(10),a.setTextColor(100,100,100),a.text(`Page ${e} of ${r}`,105,287,null,null,"center");a.save(`${n.replace(" ","_")}_${o.getTime()}.pdf`),oe(`${n} exported successfully!`,!1)}catch(e){oe("Failed to generate PDF: "+e.message,!0)}else oe("No CGPA data to export.",!0);else oe("No SGPA data to export.",!0)})),u.addEventListener("click",(()=>{const e=document.querySelector("#mainTabs .tab.active").getAttribute("data-tab");if("sgpa-calc"!==e||0!==Y.length)if("cgpa-calc"!==e||0!==z.length)try{let t="",a="";if("sgpa-calc"===e){t+="Subject Code,Subject Name,Credits,Grade,Points\n",Y.filter((e=>"number"==typeof e.grade&&!isNaN(e.grade)&&e.credits>0)).forEach((e=>{t+=`"${e.code}","${e.name}",${e.credits.toFixed(1)},"${Q[e.grade]}",${e.grade.toFixed(2)}\n`}));const e=te();t+=`\nSGPA,,,${e.toFixed(2)}\n`,a=`sgpa_report_${(new Date).getTime()}.csv`}else if("cgpa-calc"===e){t+="Semester SGPA,Total Credits,Weighted Points\n",z.forEach((e=>{t+=`${e.sgpa.toFixed(2)},${e.credits.toFixed(1)},${(e.sgpa*e.credits).toFixed(2)}\n`}));const e=de();t+=`\nCGPA,,,${e.toFixed(2)}\n`,a=`cgpa_report_${(new Date).getTime()}.csv`}const n=new Blob([t],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),d=URL.createObjectURL(n);s.setAttribute("href",d),s.setAttribute("download",a),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),oe("CSV exported successfully!",!1)}catch(e){oe("Failed to generate CSV: "+e.message,!0)}else oe("No CGPA data to export.",!0);else oe("No SGPA data to export.",!0)})),window.deleteSubject=function(e){Y.splice(e,1),ee(),ae(),ne(),oe("Subject deleted.",!1)},F.addEventListener("click",(()=>{let e=!0;const t=parseFloat(k.value);W(k,P,(e=>!isNaN(parseFloat(e))&&parseFloat(e)>=0&&parseFloat(e)<=10),"SGPA must be between 0 and 10.")||(e=!1);const a=parseFloat(T.value);W(T,L,(e=>!isNaN(parseFloat(e))&&parseFloat(e)>0),"Credits must be a positive number.")||(e=!1),e?(z.push({sgpa:t,credits:a}),se(),ie(),oe("Semester added for CGPA calculation!",!1),k.value="",T.value=""):oe("Please correct the errors in the form.",!0)})),I.addEventListener("click",(()=>{Z("Are you sure you want to clear all previous semester data for CGPA?",(e=>{e&&(z=[],se(),ie(),oe("All semester data cleared for CGPA!",!1))}))})),window.deleteSemester=function(e){z.splice(e,1),se(),ie(),oe("Semester entry deleted.",!1)},"dark"===localStorage.getItem("gradeFlowTheme")?document.body.classList.add("dark-mode"):document.body.classList.remove("dark-mode"),Y=[],z=[],document.querySelector('#mainTabs .tab[data-tab="sgpa-calc"]').click(),document.querySelector('#sgpaSubTabs .tab[data-tab="manual-sgpa"]').click(),ee(),se(),ae(),ie(),ne(),O(),le(),v.value="",b.value="",f.value="",y.value="",k.value="",T.value="",document.querySelectorAll(".invalid").forEach((e=>e.classList.remove("invalid"))),document.querySelectorAll(".error-message").forEach((e=>e.textContent="")),x.addEventListener("click",(()=>{const e=C.value.trim();if(e){const t=encodeURIComponent("GradeFlow Pro Feedback/Bug Report"),a=encodeURIComponent(e);window.location.href=`mailto:futureengineer9915@gmail.com?subject=${t}&body=${a}`,C.value=""}else oe("Please enter your feedback or bug description.",!0)}))}document.addEventListener("selectstart",disableSelect),document.addEventListener("DOMContentLoaded",(()=>{renderUI(),initApp()}));
